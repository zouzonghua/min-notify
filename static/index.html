<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>邮件服务配置</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px 15px; }
    .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>邮件服务配置</h1>

  <div class="section">
    <h2>SMTP 配置信息</h2>
    <label>SMTP 服务器: <input id="smtp_server"></label>
    <label>SMTP 端口: <input id="smtp_port" type="number"></label>
    <label>SMTP 用户: <input id="smtp_user"></label>
    <label>SMTP 密码: <input id="smtp_pass" type="password"></label>
    <label>发送人名称: <input id="sender_name" placeholder="例如：系统通知"></label>
    <label>收件人邮箱: <input id="to_email"></label>
    <button onclick="saveConfig()">保存配置</button>
  </div>

  <div class="section">
    <h2>测试发送邮件</h2>
    <label>标题: <input id="test_title" value="测试邮件"></label>
    <label>内容: <textarea id="test_message" rows="4">这是一封测试邮件</textarea></label>
    <button onclick="sendTest()">发送测试</button>
  </div>

  <pre id="output"></pre>

  <script>
    async function loadConfig() {
      let res = await fetch('/api/config');
      let cfg = await res.json();
      document.getElementById('smtp_server').value = cfg.smtp_server;
      document.getElementById('smtp_port').value = cfg.smtp_port;
      document.getElementById('smtp_user').value = cfg.smtp_user;
      document.getElementById('smtp_pass').value = cfg.smtp_pass;
      document.getElementById('sender_name').value = cfg.sender_name || '';
      document.getElementById('to_email').value = cfg.to_email;
    }

    async function saveConfig() {
      let cfg = {
        smtp_server: document.getElementById('smtp_server').value,
        smtp_port: parseInt(document.getElementById('smtp_port').value),
        smtp_user: document.getElementById('smtp_user').value,
        smtp_pass: document.getElementById('smtp_pass').value,
        sender_name: document.getElementById('sender_name').value,
        to_email: document.getElementById('to_email').value,
      };
      let res = await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(cfg)
      });
      document.getElementById('output').textContent = await res.text();
    }

    async function sendTest() {
      let data = {
        title: document.getElementById('test_title').value,
        message: document.getElementById('test_message').value
      };
      let res = await fetch('/notify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      document.getElementById('output').textContent = await res.text();
    }

    loadConfig();
  </script>
</body>
</html>
